#!/usr/bin/env sh
# Theme switch for firefox, tmux, alacritty and (neo)vim.

LIGHTTHEME=catppuccin-latte
DARKTHEME=catppuccin-mocha
VIMCONF=${XDG_CONFIG_HOME}/nvim/lua/config/set.lua
ALACRITTYCONF=${XDG_CONFIG_HOME}/alacritty/alacritty.yml
TMUXCONF=${XDG_CONFIG_HOME}/tmux/tmux.conf

if [ "$1" = "light" ]; then
  gsettings set org.gnome.desktop.interface color-scheme 'prefer-light'
  sed -i 's/'"$DARKTHEME"'/'"$LIGHTTHEME"'/' "$ALACRITTYCONF"
  sed -i 's/'"$DARKTHEME"'/'"$LIGHTTHEME"'/' "$TMUXCONF"
  sed -i 's/dark/light/' "$VIMCONF"
  tmux list-panes -a -F '#{pane_id} #{pane_current_command}' |
    grep vim |
    cut -d ' ' -f 1 |
    xargs -I PANE tmux send-keys -t PANE ESCAPE ":set background=light" ENTER
fi

if [ "$1" = "dark" ]; then
  gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
  sed -i 's/'"$LIGHTTHEME"'/'"$DARKTHEME"'/' "$ALACRITTYCONF"
  sed -i 's/'"$LIGHTTHEME"'/'"$DARKTHEME"'/' "$TMUXCONF"
  sed -i 's/light/dark/' "$VIMCONF"
  tmux list-panes -a -F '#{pane_id} #{pane_current_command}' |
    grep vim |
    cut -d ' ' -f 1 |
    xargs -I PANE tmux send-keys -t PANE ESCAPE ":set background=dark" ENTER
fi

tmux source-file "$TMUXCONF"
